{% extends "base.html" %}

{% block title %}è³¼è²·å‡ç´š{% endblock %}

{% block content %}
<div class="purchase-container fade-in">
  <h2 class="slide-up">ğŸ›’ è³¼è²·å‡ç´šæ–¹æ¡ˆ</h2>

  <div class="user-status slide-up delay-1">
    <p><strong>ç›®å‰æœƒå“¡ç­‰ç´šï¼š</strong> {{ current_plan }}</p>
  </div>

  <form method="POST" class="purchase-form slide-up delay-2" id="purchase-form">
    <input type="hidden" name="plan" id="selected-plan">

    <div class="row">
      {% set plans = [
        {"key": "Free", "icon": "ğŸ†“", "price": "NT$0", "desc": "- æ¯æ—¥ 3 æ¬¡\n- åŸºæœ¬åŠŸèƒ½\n- ç„¡å„ªå…ˆè™•ç†"},
        {"key": "Pro", "icon": "ğŸš€", "price": "NT$99 / æœˆ", "desc": "- æ¯æ—¥ 10 æ¬¡\n- é©åˆæ´»èºä½¿ç”¨è€…\n- æ™®é€šé€Ÿåº¦"},
        {"key": "Premium", "icon": "ğŸŒŸ", "price": "NT$199 / æœˆ", "desc": "- ç„¡é™æ¬¡æ•¸\n- å¿«é€Ÿå„ªå…ˆè™•ç†\n- å…¨åŠŸèƒ½é–‹æ”¾"}
      ] %}      

      {% for plan in plans %}
        <div class="col-md-4">
          <div class="membership-card {% if plan.key == current_plan %}current{% endif %}" 
               data-plan="{{ plan.key }}"
               {% if plan.key == current_plan %}data-current="true"{% endif %}>
               <div class="membership-title">
                {{ plan.icon }} {{ plan.key }}
                <span style="float: right; font-size: 16px; color: #007bff;">{{ plan.price }}</span>
              </div>              
            <div class="membership-benefit">
              {{ plan.desc | replace('\n', '<br>') | safe }}
            </div>
            {% if plan.key == current_plan %}
              <div class="badge-current">âœ… ç›®å‰æ–¹æ¡ˆ</div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

    <button type="submit" class="btn btn-success mt-3" disabled id="submit-btn">ç«‹å³å‡ç´š â¤</button>
  </form>
</div>

<script>
  const cards = document.querySelectorAll(".membership-card");
  const selectedPlanInput = document.getElementById("selected-plan");
  const submitBtn = document.getElementById("submit-btn");

  cards.forEach((card) => {
    // ä¸èƒ½é¸ç›®å‰æ–¹æ¡ˆ
    if (card.dataset.current === "true") return;

    card.addEventListener("click", () => {
      cards.forEach((c) => c.classList.remove("selected"));
      card.classList.add("selected");

      const plan = card.getAttribute("data-plan");
      selectedPlanInput.value = plan;
      submitBtn.disabled = false;
    });
  });
</script>
{% endblock %}